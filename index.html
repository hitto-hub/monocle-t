<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Monocle</title>
  <link rel="stylesheet" href="./src/style.css">
  <script src="./src/monocle.js"></script>
  <script>

    var buttons
    window.onload = _ => {
      buttons = Array.from(document.querySelectorAll("button"))
      buttons.map(b => b.disabled = true)
      document.querySelector("#connect").disabled = false
    }

    function sendFromButton() {
      if (!myMonocle) { console.error('no monocle found'); return; }
      parsedcode = this.parentElement.children[1].value
      console.log('parsedcode:', parsedcode)
      myMonocle.repl(parsedcode)
        .then(r => showOutput(r))
    }

    function showOutput(r) {
      console.log('raw return:', r)
      document.querySelector("#output").innerText
        += r.replace('OK', '').slice(0, -3)
    }
  </script>
</head>

<body>

  <button id="connect" onclick="connect().then(_=&gt; buttons.map( b =&gt; b.disabled = false ) )">connect</button>

  <div>
    <h3>
      フラッシュ暗算
    </h3>
    <textarea cols="80">import display
display.show( display.Text( "Hi from JS", 100, 100, display.GREEN) )</textarea>
    <br>
    <button onclick="sendFromButton.call(this)" disabled="">send</button>
  </div>
  <div>
    <h3>
      output
    </h3>
    <button onclick="document.querySelector(&#39;#output&#39;).innerText=&#39;&#39;" disabled="">clear</button>
    <div style="background-color:white; width:100%; height:200px;">
      <code id="output"></code>
    </div>
  </div>

  <footer class="footer">
    <h4>Around</h4>
    <ul>
      <li><a role="button" href="https://"><i class="">あ</i></a></li>
      <li><a role="button" href="https://"><i class="">あ</i></a></li>
    </ul>

  </footer>

</body>

</html>